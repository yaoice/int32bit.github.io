---
layout: post
title: Golang知识点
subtitle: ""
catalog: true
hide: true
tags:
     - Go
---

### defer 7个知识点

1. defer的执行顺序

    有多个defer的时候，是按照栈的关系来执行

2. defer与return谁先谁后

    return之后的语句先执行，defer后的语句后执行
    
3. 函数的返回值初始化与defer间接影响

    只要声明函数的返回值变量名称，就会在函数初始化时候为之赋值为0，而且在函数体作用域可见
    
4. 有名函数返回值遇见defer情况

    通过知识点2得知，先return，再defer，所以在执行完return之后，还要再执行defer里的语句，依然可以修改本应该返回的结果

5. defer遇见panic

    遇到panic时，遍历本协程的defer链表，并执行defer。在执行defer过程中:遇到recover则停止panic，返回recover处继续往下执行。如果没有遇到recover，遍历完本协程的defer链表后，向stderr抛出panic信息

6. defer中包含panic

    panic仅有最后一个可以被revover捕获

7. defer下的函数参数包含子函数    
        
### atomic.Value vs sync.Mutex

原子操作由底层硬件支持，而锁则由操作系统的调度器实现。锁应当用来保护一段逻辑，对于一个变量更新的保护，原子操作通常会更有效率，并且更能利用计算机多核的优势，
如果要更新的是一个复合对象，则应当使用atomic.Value封装好的实现。


### 参考链接

- [golang中的defer必掌握的7知识点golang中的defer必掌握的7知识点](https://www.dailybtc.cn/golang%e4%b8%ad%e7%9a%84defer%e5%bf%85%e6%8e%8c%e6%8f%a1%e7%9a%847%e7%9f%a5%e8%af%86%e7%82%b9golang%e4%b8%ad%e7%9a%84defer%e5%bf%85%e6%8e%8c%e6%8f%a1%e7%9a%847%e7%9f%a5%e8%af%86%e7%82%b9/)
- [Go 语言标准库中 atomic.Value 的前世今生](https://blog.betacat.io/post/golang-atomic-value-exploration/)
